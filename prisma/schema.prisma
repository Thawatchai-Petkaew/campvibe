// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums based on 'Option v1'
// Note: SQLite doesn't enforce Enums natively, Prisma handles them as Strings.

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String?  // Hashed password for credentials auth
  name      String?
  image     String?  // Profile image URL
  phone     String?  // Contact phone number
  role      String   @default("CAMPER") // 'ADMIN', 'OPERATOR', 'CAMPER'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  campgrounds Campground[] // Operator's campgrounds
  reviews     Review[]     // User's reviews
  bookings    Booking[]    // User's bookings
}

model ThailandLocation {
  id            String   @id @default(uuid())
  provinceCode  String   // e.g., "10" for Bangkok
  provinceName  String   // "กรุงเทพมหานคร"
  provinceNameEn String  // "Bangkok"
  districtCode  String?  // e.g., "1001"
  districtName  String?  // "เขตพระนคร"
  districtNameEn String? // "Phra Nakhon"
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  locations Location[]
  
  @@unique([provinceCode, districtCode])
  @@index([provinceName, districtName])
}

model Location {
  id          String  @id @default(uuid())
  country     String  @default("Thailand")
  region      String?
  province    String?
  district    String?
  subDistrict String?
  village     String?
  lat         Float?
  lon         Float?
  
  // Link to Thailand administrative division
  thaiLocationId String?
  thaiLocation   ThailandLocation? @relation(fields: [thaiLocationId], references: [id])
  
  campgrounds Campground[]
}

model Campground {
  id          String   @id @default(uuid())
  // Core Identification
  nameTh      String
  nameEn      String?
  nameThSlug  String   @unique
  nameEnSlug  String   @unique
  description String?
  
  // Classification
  campgroundType   String // Relation to MasterData code (e.g. CAGD)
  
  // Media
  images           String? // CSV of image URLs
  videoUrl         String? // "VDO"
  albumUrl         String? // "Photo set"
  
  // Legacy arrays (to be migrated to MasterData relations)
  accessTypes      String 
  accommodationTypes String 
  facilities       String // Internal facilities
  externalFacilities String? // CSV
  equipment        String? // CSV (Equipment for rent)
  activities       String? // CSV
  terrain          String? // CSV 
  
  // Geolocation & Address
  latitude         Float
  longitude        Float
  address          String?
  directions       String?
  
  // Operations & Info
  checkInTime      String
  checkOutTime     String
  bookingMethod    String
  feeInfo          String?
  toiletInfo       String?
  minimumAge       Int?
  contacts         String?
  
  // Pricing
  priceLow         Float?
  priceHigh        Float?
  
  // Status & Dates
  isVerified       Boolean @default(false)
  verifiedDate     DateTime?
  isActive         Boolean @default(true)
  isPublished      Boolean @default(false)
  publicDate       DateTime?
  
  tags             String? // CSV
  
  // Additional Info
  partner          String?
  nationalPark     String?
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  // Relations
  locationId       String
  location         Location @relation(fields: [locationId], references: [id])
  
  operatorId       String
  operator         User     @relation(fields: [operatorId], references: [id])
  
  sites            Site[]
  reviews          Review[]
  bookings         Booking[]

  // Options & Features (New Data-Driven Approach)
  options          MasterData[]
}

model MasterData {
  code        String   @id // e.g. "SHOW", "WIFI"
  group       String   // e.g. "Internal facility"
  nameTh      String
  nameEn      String
  icon        String?  // Optional icon identifier
  
  campgrounds Campground[]
}

model Site {
  id             String   @id @default(uuid())
  name           String   // "Site name"
  maxCampers     Int?     // "Maximun campers"
  maxTents       Int?     // "Maximun tents"
  environment    String?
  pricePerNight  Float    // "Price per night"
  pricePerSite   Float?
  
  nearFacilities String?  // CSV of Facility codes
  
  campgroundId   String
  campground     Campground @relation(fields: [campgroundId], references: [id])
  bookings       Booking[]
}

model Review {
  id          String   @id @default(uuid())
  title       String?
  content     String?
  rating      Int
  
  visitDate   DateTime?
  
  mediaUrls   String? // CSV of image URLs
  
  campgroundId String
  campground   Campground @relation(fields: [campgroundId], references: [id])
  
  authorId     String
  author       User       @relation(fields: [authorId], references: [id])
  
  createdAt    DateTime @default(now())
}

model Booking {
  id            String   @id @default(uuid())
  
  checkInDate   DateTime
  checkOutDate  DateTime
  guests        Int      @default(1)
  totalPrice    Float
  
  status        String   @default("CONFIRMED") // PENDING, CONFIRMED, CANCELLED
  
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  
  campgroundId  String
  campground    Campground @relation(fields: [campgroundId], references: [id])
  
  siteId        String?
  site          Site?    @relation(fields: [siteId], references: [id])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
